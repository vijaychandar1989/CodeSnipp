DECLARE @RATE_ID CHAR(6)
DECLARE @AMT Money, @SUM_AMT MONEY, @RECS INT
DECLARE @STARTDATE DATETIME, @ENDDATE DATETIME
SET @RATE_ID = 'A4480'

SELECT @STARTDATE = GETDATE()

SELECT 	@SUM_AMT = SUM(RATE),
	@RECS = COUNT(*)
FROM	TST_DATA
WHERE	RATE_ID = @RATE_ID
AND	RATE_PFX = 'H2'

SELECT DATEDIFF(MS, @STARTDATE, GETDATE()) AS RUN_TIME, 
	@SUM_AMT AS SUM_AMT,
	@RECS AS RECORDS 

SELECT @STARTDATE = GETDATE()
-- =============================================
-- Declare and using a READ_ONLY cursor
-- =============================================

SET @AMT = 0
SET @SUM_AMT = 0
SET @RECS = 0

DECLARE C1 CURSOR
READ_ONLY
FOR 
SELECT	RATE
FROM	TST_DATA
WHERE	RATE_ID = @RATE_ID
AND	RATE_PFX = 'H2'

OPEN 	C1

FETCH NEXT FROM C1 INTO @AMT
WHILE (@@fetch_status <> -1)
BEGIN
	IF (@@fetch_status <> -2)
	BEGIN
		SET @SUM_AMT = @SUM_AMT + @AMT
		SET @RECS = @RECS + 1
	END
	FETCH NEXT FROM C1 INTO @AMT
END

CLOSE C1
DEALLOCATE C1

SELECT DATEDIFF(MS, @STARTDATE, GETDATE()) AS RUN_TIME, 
	@SUM_AMT AS SUM_AMT,
	@RECS AS RECORDS 
GO
